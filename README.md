# AI Agent Challenge - Bank Statement Parser Generator

An autonomous coding agent that generates custom PDF parsers for bank statements using LLM-powered code generation.

## ğŸ¯ Overview

This project implements an AI agent that:
- Reads bank statement PDFs and expected CSV outputs
- Autonomously generates Python parser code
- Tests the generated parser against expected results
- Self-corrects errors through iterative refinement (up to 3 attempts)
- Works for any bank without manual code changes

## ğŸ—ï¸ Agent Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AGENT LOOP (ParserAgent)                â”‚
â”‚                                                      â”‚
â”‚  1. PLAN     â†’ Analyze PDF structure & CSV schema   â”‚
â”‚       â†“                                              â”‚
â”‚  2. GENERATE â†’ Write parser code using Groq LLM     â”‚
â”‚       â†“                                              â”‚
â”‚  3. TEST     â†’ Run parse() and compare DataFrames   â”‚
â”‚       â†“                                              â”‚
â”‚  4. REFLECT  â†’ If failed, analyze error             â”‚
â”‚       â†“                                              â”‚
â”‚  5. ITERATE  â†’ Refine code (max 3 attempts)         â”‚
â”‚                                                      â”‚
â”‚  Memory: Stores conversation history for context    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start (5 Steps)

### 1. Clone and Setup
```bash
git clone https://github.com/YOUR_USERNAME/ai-agent-challenge.git
cd ai-agent-challenge
python -m venv venv

# Activate virtual environment
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

pip install -r requirements.txt
```

### 2. Configure API Key
Create `.env` file in project root:
```env
GROQ_API_KEY=your_groq_api_key_here
```

Get your free API key from: https://console.groq.com/

### 3. Prepare Data
Add your bank statement files to `data/<bank_name>/`:
```
data/
â””â”€â”€ icici/
    â”œâ”€â”€ icici_sample.pdf    # Bank statement PDF
    â””â”€â”€ icici_sample.csv    # Expected output format
```

### 4. Run Agent
```bash
python agent.py --target icici
```

Expected output:
```
âœ… Using Groq model: llama-3.3-70b-versatile
ğŸ¤– Starting agent for icici bank...
ğŸ“‹ Step 1: Planning...
ğŸ”„ Iteration 1/3
  ğŸ“ Generating parser code...
  ğŸ’¾ Saved to custom_parsers\icici_parser.py
  ğŸ§ª Testing parser...
âœ… Parser works correctly!
```

### 5. Test Generated Parser
```bash
pytest tests/test_parser.py -v
```

## ğŸ“ Project Structure

```
ai-agent-challenge/
â”œâ”€â”€ agent.py                    # Main agent (autonomous loop)
â”œâ”€â”€ custom_parsers/             # Generated parsers
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ icici_parser.py        # Auto-generated by agent
â”œâ”€â”€ data/                       # Sample bank statements
â”‚   â””â”€â”€ icici/
â”‚       â”œâ”€â”€ icici_sample.pdf
â”‚       â””â”€â”€ icici_sample.csv
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_parser.py         # Validation tests
â”œâ”€â”€ create_icici_pdf.py        # Helper to create test PDFs
â”œâ”€â”€ .env                        # API keys (not in git)
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## ğŸ”§ How It Works

### Agent Components

**1. ParserAgent Class**
- `__init__()`: Initializes Groq LLM client
- `plan()`: Analyzes PDF structure and plans approach
- `generate_parser()`: Creates initial parser code using LLM
- `test_parser()`: Dynamically imports and tests generated code
- `refine()`: Fixes errors based on test feedback
- `run()`: Orchestrates the complete agent loop

**2. Parser Contract**

All generated parsers must implement:
```python
def parse(pdf_path: str) -> pd.DataFrame:
    """
    Extract transactions from bank statement PDF.
    
    Args:
        pdf_path: Path to the PDF file
        
    Returns:
        DataFrame with columns: ['Date', 'Description', 'Debit Amt', 'Credit Amt', 'Balance']
    """
```

**3. Testing Strategy**

The agent compares generated parser output with expected CSV using:
- Column name matching
- Row count verification
- Value-by-value DataFrame comparison
- Detailed error reporting for debugging

## ğŸ“ Adding New Banks

The agent works for any bank without code changes:

```bash
# 1. Create data directory
mkdir -p data/sbi

# 2. Add sample files
# - data/sbi/sbi_sample.pdf
# - data/sbi/sbi_sample.csv

# 3. Run agent
python agent.py --target sbi

# 4. Test it
pytest tests/test_parser.py -v
```

## ğŸ“Š Results

### ICICI Bank Parser
- **Status**: âœ… Success
- **Transactions Parsed**: 100
- **Iterations Required**: 1
- **Test Status**: PASSED

### Sample Output
```python
from custom_parsers.icici_parser import parse
df = parse('data/icici/icici_sample.pdf')
print(df.head())

         Date                Description  Debit Amt  Credit Amt  Balance
0  01-08-2024  Salary Credit XYZ Pvt Ltd    1935.30        0.00  6864.58
1  02-08-2024  Salary Credit XYZ Pvt Ltd       0.00     1652.61  8517.19
2  03-08-2024    IMPS UPI Payment Amazon    3886.08        0.00  4631.11
```

## ğŸ› ï¸ Technologies

- **LLM**: Groq (llama-3.3-70b-versatile)
- **PDF Parsing**: pdfplumber, pypdf2
- **Data Processing**: pandas
- **Testing**: pytest
- **Environment**: python-dotenv
- **PDF Generation**: reportlab (for test data)

## ğŸ§ª Testing

```bash
# Test specific parser
pytest tests/test_parser.py::test_icici_parser -v

# Run all tests
pytest tests/ -v

# Manual test
python -c "from custom_parsers.icici_parser import parse; df = parse('data/icici/icici_sample.pdf'); print(df)"
```

## ğŸ“ Key Features

- âœ… **Autonomous**: Self-debugging with retry logic (3 attempts)
- âœ… **Generalizable**: Works for any bank without code changes
- âœ… **Type-Safe**: Full type hints throughout
- âœ… **Tested**: Automatic validation against expected output
- âœ… **Memory**: Maintains conversation history for context
- âœ… **Fast**: Uses Groq for rapid code generation

## ğŸ¥ Demo

To record a 60-second demo:

1. **Fresh clone** (0-10s): `git clone <repo> && cd ai-agent-challenge`
2. **Setup** (10-25s): `pip install -r requirements.txt`
3. **Run agent** (25-45s): `python agent.py --target icici`
4. **Test** (45-60s): `pytest tests/test_parser.py -v`

## ğŸ› Troubleshooting

| Issue | Solution |
|-------|----------|
| `GROQ_API_KEY not found` | Check `.env` file exists with valid API key |
| `ModuleNotFoundError: pdfplumber` | Run `pip install -r requirements.txt` |
| `Shape mismatch` | Check CSV for duplicate headers, remove them |
| Test fails | Ensure CSV format matches PDF structure exactly |

## ğŸ“„ Evaluation Criteria

| Criteria | Weight | Status |
|----------|--------|--------|
| Agent Autonomy (self-debug loops) | 35% | âœ… Implemented |
| Code Quality (typing, docs, clarity) | 25% | âœ… Complete |
| Architecture (clear graph/node design) | 20% | âœ… Documented |
| Demo (fresh clone â†’ green pytest) | 20% | âœ… Working |

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Add your improvements
4. Test thoroughly with `pytest`
5. Submit a pull request

## ğŸ“„ License

MIT

## ğŸ™ Credits

Built for the Agent-as-Coder Challenge by Korefi.

**Author**: [Niranjan]  
**Date**: September 2025  
**LLM Provider**: Groq (Free Tier)

---


**Note**: This agent uses Groq's free API tier. For production use, consider rate limits and add error handling for API failures.
